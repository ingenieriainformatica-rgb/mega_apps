<?xml version="1.0" encoding="utf-8"?>
<odoo>

  <!-- search -->
  <record id="account_petty_cash_box" model="ir.ui.view">
    <field name="name">petty.cash.box.search</field>
    <field name="model">petty.cash.box</field>
    <field name="arch" type="xml">
        <search>
          <field name="sequence" string="Referencia"/>
          <field name="user_id" string="Responsable"/>
          <!-- Filtros rápidos por estado -->
          <filter name="state_draft" string="Borrador" domain="[('state','=','draft')]"/>
          <filter name="state_open" string="Abierta" domain="[('state','=','open')]"/>
          <filter name="state_closed" string="Cerrada" domain="[('state','=','closed')]"/>
          <group expand="0" string="Agrupar por">
            <filter name="grp_state" string="Estados" context="{'group_by':'state'}"/>
          </group>
          <!-- <filter name="ctrl_cash"
              string="Control de efectivo"
              domain="[('opening_type_id.name','ilike','control_efectivo')]"/> -->
        </search>
    </field>
  </record>

  <!-- Lista -->
  <record id="view_petty_cash_box_tree" model="ir.ui.view">
    <field name="name">petty.cash.box.tree</field>
    <field name="model">petty.cash.box</field>
    <field name="arch" type="xml">
      <list delete="false" duplicate="false">
        <field name="sequence"/>
        <field name="user_id"/>
        <field name="company_id" optional="hide"/>
        <field name="date_open"/>
        <field name="date_closed"/>
        <field name="amount_start"/>
        <field name="amount_available"/>
        <field name="state" widget="badge"
            decoration-info="state == 'draft'"
            decoration-success="state == 'open'"
            decoration-danger="state == 'closed'"/>
      </list>
    </field>
  </record>

  <!-- Formulario -->
  <record id="view_petty_cash_box_form" model="ir.ui.view">
    <field name="name">petty.cash.box.form</field>
    <field name="model">petty.cash.box</field>
    <field name="arch" type="xml">
      <form string="Caja Menor" duplicate="false" delete="false">
        <header>
          <button
            name="action_closed_box_cash"
            type="object"
            string="Cerrar caja"
            invisible="state != 'open'"
            confirm="¿Seguro que deseas cerrar la caja? Esta acción no se puede deshacer."
            class="btn-primary"/>
          <field name="state" widget="statusbar" statusbar_visible="draft,open,closed"/>
        </header>
        <sheet>
          <widget name="web_ribbon"
              title="Caja cerrada"
              bg_color="bg-danger"
              text_color="text-white"
              invisible="state != 'closed'"/>
          <div class="oe_title">
            <h1>
              <span class="o_stat_text"><field name="sequence" readonly="1"/></span>
            </h1>
          </div>
          <group>
            <group string="Información">
              <field
                name="user_id"
                readonly="1"
                options="{'no_open': True, 'no_create': True, 'no_create_edit': True}"/>
              <field name="date_open" readonly="1"/>
              <field name="date_closed" invisible="state != 'closed'" readonly="1"/>
            </group>
            <group string="Saldos">
              <field name="currency_id" invisible="1"/>
              <field name="amount_start" readonly="1" invisible="state in ('draft', 'open')" string="Saldo inicial"/>
              <field name="opening_type_quantity" string="Saldo inicial" invisible="state in ('closed')"/>
              <field name="amount_available" readonly="1" string="Saldo final"/>
            </group>
          </group>
          <notebook>
            <page string="Movimientos">
              <group>
                <field name="line_ids" string="" readonly="state == 'closed'"/>
              </group>
            </page>
          </notebook>
        </sheet>
        <chatter/>
      </form>
    </field>
  </record>

  <!-- Acción y menú -->
  <record id="action_petty_cash_box" model="ir.actions.act_window">
    <field name="name">Control de efectivo Mega</field>
    <field name="res_model">petty.cash.box</field>
    <field name="view_mode">list,form</field>
    <field name="domain">[('opening_type_id.name', '=', 'control_efectivo')]</field>
    <field name="context">{'option_control': 'control_efectivo'}</field>
    <field name="help" type="html">
      <p class="o_view_nocontent_empty_folder">
          Control de efectivo
      </p>
      <p>
          Crea tu primera Control de efectivo!!!
      </p>
    </field>
  </record>

</odoo>
