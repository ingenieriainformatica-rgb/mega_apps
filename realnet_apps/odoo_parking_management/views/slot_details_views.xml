<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <!-- Search view for slot details -->
    <record id="slot_details_view_search" model="ir.ui.view">
        <field name="name">slot.details.view.search</field>
        <field name="model">slot.details</field>
        <field name="arch" type="xml">
            <search string="Slots">
                <field name="name"/>
                <field name="code"/>
                <field name="site_id"/>
                <field name="slot_type_id"/>
                <separator/>
                <filter name="available" string="Available Slots" domain="[('is_available','=',True)]"/>
                <filter name="occupied" string="Occupied Slots" domain="[('is_available','=',False)]"/>
                <separator/>
                <group expand="0" string="Group By">
                    <filter name="group_by_site" string="Site" context="{'group_by': 'site_id'}"/>
                    <filter name="group_by_slot_type" string="Slot Type" context="{'group_by': 'slot_type_id'}"/>
                    <filter name="group_by_availability" string="Availability" context="{'group_by': 'is_available'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Kanban view for slot details -->
    <record id="slot_details_view_kanban" model="ir.ui.view">
        <field name="name">slot.details.view.kanban</field>
        <field name="model">slot.details</field>
        <field name="arch" type="xml">
            <kanban default_group_by="slot_type_id" class="o_kanban_small_column o_kanban_project_tasks"
                    records_draggable="false" default_order="slot_type_id"
                    examples="project" js_class="project_task_kanban"
                    sample="1" create="1" edit="0" group_create="0">
                <field name="name"/>
                <field name="is_available"/>
                <field name="current_parking_entry_id"/>
                <templates>
                    <t t-name="card">
                        <div t-attf-class="oe_kanban_global_click"
                             t-attf-style="background: #{record.is_available.raw_value ? 'lightgreen' : 'lightcoral'};">
                            <div class="oe_kanban_details">
                                <strong>
                                    <field name="name"/>
                                    <br/>
                                </strong>
                                <div t-if="record.is_available.raw_value" class="text-success">
                                    <i class="fa fa-check-circle"/> Available
                                </div>
                                <div t-if="!record.is_available.raw_value" class="text-danger">
                                    <i class="fa fa-car"/> Occupied
                                    <br/>
                                    <small t-if="record.current_parking_entry_id.raw_value">
                                        Entry: <t t-esc="record.current_parking_entry_id.value"/>
                                    </small>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Tree view for slot details -->
    <record id="view_slot_details_view_tree" model="ir.ui.view">
        <field name="name">slot.details.view.tree</field>
        <field name="model">slot.details</field>
        <field name="arch" type="xml">
            <list string="Slot">
                <field name="code"/>
                <field name="name"/>
                <field name="site_id"/>
                <field name="slot_type_id"/>
                <field name="is_available"/>
                <field name="current_parking_entry_id"/>
            </list>
        </field>
    </record>
    <!-- Form view for slot details -->
    <record id="slot_details_view_form" model="ir.ui.view">
        <field name="name">slot.details.view.form</field>
        <field name="model">slot.details</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <field name="is_available" widget="boolean_toggle" nolabel="1"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="name"/>
                            <field name="code"/>
                            <field name="is_available" string="Available"/>
                        </group>
                        <group>
                            <field name="site_id" 
                                   options="{'no_create': True, 'no_create_edit': True}"
                                   required="1"/>
                            <field name="slot_type_id"/>
                            <field name="current_parking_entry_id" readonly="1"/>
                        </group>
                    </group>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>
    <!--    Menu action for slot details-->
    <record id="slot_details_action_slot_details" model="ir.actions.act_window">
        <field name="name">Slots</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">slot.details</field>
        <field name="view_mode">list,form</field>
        <field name="context">{'search_default_available':1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create Your First Slot
            </p>
        </field>
    </record>
<!--    Slot details action all slots-->
    <record id="slot_details_action_all_slots" model="ir.actions.act_window">
        <field name="name">All Slots</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">slot.details</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="context">{}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Display all the slots
            </p>
        </field>
    </record>
<!--Slot details action all slots-->
    <record id="parking_entry_action_allocated_slots" model="ir.actions.act_window">
        <field name="name">Allocated Slots</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">slot.details</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="view_id" ref="odoo_parking_management.slot_details_view_kanban"/>
        <field name="search_view_id" ref="slot_details_view_search"/>
        <field name="domain">[('is_available','=',False)]</field>
        <field name="context">{'search_default_group_by_site':1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No Allocated Slots Found
            </p>
            <p>
                Allocated slots are those currently occupied by vehicles (with active parking entries in check_in state).
            </p>
        </field>
    </record>
<!--    Parking entry action non allocated slots-->
    <record id="parking_entry_action_non_allocated_slots" model="ir.actions.act_window">
        <field name="name">Non Allocated Slots</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">slot.details</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="view_id" ref="odoo_parking_management.slot_details_view_kanban"/>
        <field name="search_view_id" ref="slot_details_view_search"/>
        <field name="domain">[('is_available','=',True)]</field>
        <field name="context">{'search_default_group_by_site':1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No Available Slots Found
            </p>
            <p>
                Available slots are those not currently occupied by any vehicle (no active parking entries in check_in state).
            </p>
        </field>
    </record>
    <!--    Menu item for slot details-->
    <menuitem id="slot_details_menu"
              name="Slots"
              parent="odoo_parking_management.parking_entry_menu_configuration_root"
              action="slot_details_action_slot_details"
              sequence="60"/>
    <menuitem id="menu_slots_root"
              name="Slots"
              parent="odoo_parking_management.parking_entry_menu_parking_management_root"
              groups="odoo_parking_management.odoo_parking_management_group_parking_manager,odoo_parking_management.group_site_operator"
              sequence="60"/>
    <menuitem id="slot_details_menu_all_slots"
              name="All Slots"
              parent="odoo_parking_management.menu_slots_root"
              action="slot_details_action_all_slots"
              sequence="20"/>
    <menuitem id="slot_details_menu_allocated_slots"
              name="Allocated Slots"
              parent="odoo_parking_management.menu_slots_root"
              action="parking_entry_action_allocated_slots"
              sequence="40"/>
    <menuitem id="slot_details_menu_not_allocated_slots"
              name="Not Allocated Slots"
              parent="odoo_parking_management.menu_slots_root"
              action="parking_entry_action_non_allocated_slots"
              sequence="40"/>
</odoo>
